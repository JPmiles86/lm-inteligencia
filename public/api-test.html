<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .pending {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-pending { background: #ffc107; }
    </style>
</head>
<body>
    <h1>ðŸ§ª API Test Dashboard</h1>
    
    <div class="test-grid">
        <!-- Simple Test (NEW) -->
        <div class="test-section" style="border: 2px solid #28a745;">
            <h3><span class="status-indicator" id="simple-status"></span>Simple Test (NEW)</h3>
            <button class="test-button" onclick="testEndpoint('simple', '/api/test-simple', 'GET')">
                Test Simple Endpoint
            </button>
            <div id="simple-result" class="result"></div>
        </div>

        <!-- OpenAI Direct Test (NEW) -->
        <div class="test-section" style="border: 2px solid #ffc107;">
            <h3><span class="status-indicator" id="openai-test-status"></span>OpenAI Direct Test (NEW)</h3>
            <button class="test-button" onclick="testOpenAIDirect()">
                Test OpenAI Key Directly
            </button>
            <div id="openai-test-result" class="result"></div>
        </div>

        <!-- Brainstorm Simple (NEW) -->
        <div class="test-section" style="border: 2px solid #28a745;">
            <h3><span class="status-indicator" id="brainstorm-simple-status"></span>Brainstorm Simple (NEW - Uses DB Key)</h3>
            <button class="test-button" onclick="testBrainstormSimple()">
                Test Simple Brainstorm
            </button>
            <div id="brainstorm-simple-result" class="result"></div>
        </div>

        <!-- Providers Simple (NEW) -->
        <div class="test-section" style="border: 2px solid #28a745;">
            <h3><span class="status-indicator" id="providers-simple-status"></span>Providers Simple (NEW)</h3>
            <button class="test-button" onclick="testEndpoint('providers-simple', '/api/providers-simple', 'GET')">
                Get Providers (Simple)
            </button>
            <div id="providers-simple-result" class="result"></div>
        </div>

        <!-- Style Guides Simple (NEW) -->
        <div class="test-section" style="border: 2px solid #28a745;">
            <h3><span class="status-indicator" id="styles-simple-status"></span>Style Guides Simple (NEW)</h3>
            <button class="test-button" onclick="testEndpoint('styles-simple', '/api/style-guides-simple', 'GET')">
                Get Style Guides (Simple)
            </button>
            <div id="styles-simple-result" class="result"></div>
        </div>

        <!-- Health Check -->
        <div class="test-section">
            <h3><span class="status-indicator" id="health-status"></span>Health Check</h3>
            <button class="test-button" onclick="testEndpoint('health', '/api/health', 'GET')">
                Test Health
            </button>
            <div id="health-result" class="result"></div>
        </div>

        <!-- Providers -->
        <div class="test-section">
            <h3><span class="status-indicator" id="providers-status"></span>Providers</h3>
            <button class="test-button" onclick="testEndpoint('providers', '/api/ai/providers', 'GET')">
                Get Providers
            </button>
            <div id="providers-result" class="result"></div>
        </div>

        <!-- Style Guides -->
        <div class="test-section">
            <h3><span class="status-indicator" id="styles-status"></span>Style Guides</h3>
            <button class="test-button" onclick="testEndpoint('styles', '/api/ai/style-guides', 'GET')">
                Get Style Guides
            </button>
            <div id="styles-result" class="result"></div>
        </div>

        <!-- Analytics -->
        <div class="test-section">
            <h3><span class="status-indicator" id="analytics-status"></span>Analytics</h3>
            <button class="test-button" onclick="testEndpoint('analytics', '/api/ai/analytics', 'GET')">
                Get Analytics
            </button>
            <div id="analytics-result" class="result"></div>
        </div>

        <!-- Brainstorm -->
        <div class="test-section">
            <h3><span class="status-indicator" id="brainstorm-status"></span>Brainstorm</h3>
            <button class="test-button" onclick="testBrainstorm()">
                Test Brainstorm
            </button>
            <div id="brainstorm-result" class="result"></div>
        </div>

        <!-- Vertical Visibility -->
        <div class="test-section">
            <h3><span class="status-indicator" id="visibility-status"></span>Vertical Visibility</h3>
            <button class="test-button" onclick="testEndpoint('visibility', '/api/vertical-visibility', 'GET')">
                Get Visibility Settings
            </button>
            <div id="visibility-result" class="result"></div>
        </div>
    </div>

    <script>
        async function testEndpoint(id, url, method, body = null) {
            const resultDiv = document.getElementById(`${id}-result`);
            const statusDiv = document.getElementById(`${id}-status`);
            
            resultDiv.className = 'result pending';
            resultDiv.textContent = 'Testing...';
            statusDiv.className = 'status-indicator status-pending';
            
            const startTime = Date.now();
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(url, options);
                const elapsed = Date.now() - startTime;
                
                let data;
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    statusDiv.className = 'status-indicator status-success';
                    resultDiv.textContent = `âœ… SUCCESS (${response.status}) - ${elapsed}ms\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    statusDiv.className = 'status-indicator status-error';
                    resultDiv.textContent = `âŒ ERROR (${response.status}) - ${elapsed}ms\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                statusDiv.className = 'status-indicator status-error';
                resultDiv.textContent = `âŒ NETWORK ERROR\n\n${error.message}\n\nThis usually means:\n- The API is not running\n- CORS is blocking the request\n- The endpoint doesn't exist`;
            }
        }

        async function testBrainstorm() {
            const body = {
                action: 'generate-ideas',
                topic: 'test topic for API validation',
                count: 3,
                vertical: 'all',
                tone: 'professional',
                contentTypes: [],
                prompt: 'Generate 3 quick test ideas',
                provider: 'openai',
                model: 'gpt-3.5-turbo'
            };
            
            await testEndpoint('brainstorm', '/api/ai/brainstorm', 'POST', body);
        }

        async function testBrainstormSimple() {
            const body = {
                topic: 'digital marketing trends',
                count: 3,
                prompt: 'Generate 3 blog post ideas about digital marketing trends'
            };
            
            await testEndpoint('brainstorm-simple', '/api/brainstorm-simple', 'POST', body);
        }

        async function testOpenAIDirect() {
            // Prompt for API key
            const apiKey = prompt('Enter your OpenAI API key to test:');
            
            if (!apiKey) {
                document.getElementById('openai-test-result').className = 'result error';
                document.getElementById('openai-test-result').textContent = 'No API key provided';
                return;
            }
            
            const body = {
                apiKey: apiKey
            };
            
            await testEndpoint('openai-test', '/api/test-openai', 'POST', body);
        }

        // Test all endpoints on load
        window.onload = () => {
            console.log('API Test Dashboard loaded. Click buttons to test each endpoint.');
        };
    </script>
</body>
</html>